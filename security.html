<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VisionBank | Security Console</title>
  <link rel="stylesheet" href="security.css" />

  <!-- Google Authenticator / TOTP library -->
  <script src="https://cdn.jsdelivr.net/npm/otplib@12.0.1/bundle/otplib.umd.min.js"></script>
</head>
<body>

  <!-- HEADER -->
  <header class="sec-header">
    <div class="sec-header-left">
      <!-- Use actual filenames from /assets -->
      <img src="assets/VisionBank-Logo.png" alt="VisionBank" class="sec-logo" />
    </div>
    <div class="sec-header-center">
      <h1>CEG Security Admin Console</h1>
      <div class="sec-subtitle">VisionBank</div>
    </div>
  </header>

  <main class="sec-main">

    <!-- LOGIN CARD -->
    <section id="login-card" class="sec-card">
      <h2>Admin Login</h2>
      <p class="sec-desc">
        Sign in with your admin ID, PIN, and Google Authenticator one-time code.
      </p>

      <div class="form-row">
        <label for="login-username">Admin ID</label>
        <input id="login-username" type="text" autocomplete="username" />
      </div>

      <div class="form-row">
        <label for="login-pin">PIN</label>
        <input id="login-pin" type="password" autocomplete="current-password" />
      </div>

      <div class="form-row">
        <label for="login-totp">Google Authenticator Code</label>
        <input id="login-totp" type="text" maxlength="6" inputmode="numeric" />
        <small id="login-totp-hint" class="hint">
          If this is your first login, youâ€™ll be guided to set up Google Authenticator.
        </small>
      </div>

      <div id="login-error" class="sec-error"></div>

      <div class="form-actions">
        <button id="btn-login">Login</button>
      </div>

      <div class="sec-small-note">
        Default Super Admin ID: <strong>superadmin</strong><br />
        Default PIN: <strong>ChangeMeNow!</strong><br />
        (You will be asked to set up MFA and change these.)
      </div>
    </section>

    <!-- MFA SETUP CARD -->
    <section id="mfa-setup-card" class="sec-card sec-card-hidden">
      <h2>Google Authenticator Setup</h2>
      <p class="sec-desc">
        Scan this QR code or use the text key below in Google Authenticator. After enrolling,
        enter a 6-digit code from the app to confirm.
      </p>

      <div class="mfa-grid">
        <div class="mfa-qr-wrapper">
          <div id="mfa-qr-placeholder" class="mfa-qr">
            Scan in Google Authenticator
          </div>
        </div>
        <div class="mfa-details">
          <div class="form-row">
            <label>Account</label>
            <div id="mfa-account-label" class="readonly-pill"></div>
          </div>
          <div class="form-row">
            <label>Secret Key</label>
            <div id="mfa-secret" class="readonly-pill"></div>
          </div>
          <div class="form-row">
            <label for="mfa-code">Enter 6-digit code from app</label>
            <input id="mfa-code" type="text" maxlength="6" inputmode="numeric" />
          </div>
          <div id="mfa-error" class="sec-error"></div>
          <div class="form-actions">
            <button id="btn-mfa-confirm">Confirm &amp; Enable MFA</button>
          </div>
        </div>
      </div>
    </section>

    <!-- MAIN ADMIN CONSOLE -->
    <section id="admin-console" class="sec-card sec-card-hidden">
      <div class="sec-card-header">
        <h2>Security Settings</h2>
        <div class="admin-info">
          Logged in as <span id="current-admin"></span>
          <button id="btn-logout" class="sec-link-btn">Logout</button>
        </div>
      </div>

      <!-- Business Hours -->
      <div class="sec-section">
        <h3>Business Hours</h3>
        <p class="sec-desc">
          These hours are enforced on the main dashboard. Outside of these times, access is denied
          unless an admin override is used.
        </p>

        <div class="hours-grid">
          <div>
            <label for="bh-start">Start (HH:MM, CST)</label>
            <input id="bh-start" type="time" />
          </div>
          <div>
            <label for="bh-end">End (HH:MM, CST)</label>
            <input id="bh-end" type="time" />
          </div>
        </div>

        <div class="days-row">
          <label>Active Days (CST)</label>
          <div class="days-checkboxes">
            <label><input type="checkbox" value="1" class="bh-day" /> Mon</label>
            <label><input type="checkbox" value="2" class="bh-day" /> Tue</label>
            <label><input type="checkbox" value="3" class="bh-day" /> Wed</label>
            <label><input type="checkbox" value="4" class="bh-day" /> Thu</label>
            <label><input type="checkbox" value="5" class="bh-day" /> Fri</label>
            <label><input type="checkbox" value="6" class="bh-day" /> Sat</label>
            <label><input type="checkbox" value="0" class="bh-day" /> Sun</label>
          </div>
        </div>

        <div class="form-actions">
          <button id="btn-save-hours">Save Business Hours</button>
        </div>
        <div id="bh-status" class="sec-status"></div>
      </div>

      <!-- Allowed IP ranges -->
      <div class="sec-section">
        <h3>Allowed IP Ranges</h3>
        <p class="sec-desc">
          Only IPs/Subnets listed here will be allowed to access the dashboard when rules are active.
          One entry per line. Example formats:
          <code>10.100.100.0/24</code>,
          <code>45.19.161.17</code>,
          <code>45.19.162.18/32</code>,
          <code>120.112.1.119/28</code>.
        </p>

        <textarea id="ip-ranges" rows="8" spellcheck="false"></textarea>

        <div class="form-actions">
          <button id="btn-save-ips">Save IP Rules</button>
        </div>
        <div id="ip-status" class="sec-status"></div>
      </div>

      <!-- Audit Log -->
      <div class="sec-section">
        <h3>Security Audit Log</h3>
        <pre id="audit-log" class="audit-box"></pre>
      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="sec-footer">
    <div class="sec-footer-left"></div>
    <div class="sec-footer-right">
      <!-- Use actual filenames from /assets -->
      <img src="assets/US-Signal-Logo.png" alt="US Signal" class="sec-footer-logo" />
      <span>Created and maintained by <strong>Ahmed Adeyemi, US Signal</strong></span>
    </div>
  </footer>

  <script src="security.js"></script>
  <script src="security-dashboard.js"></script>
</body>
</html>
