<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>VisionBank | CEG Contact Center Realtime Dashboard</title>
    <link rel="stylesheet" href="style.css" />

    <!-- =============================== -->
    <!-- SECURITY PRE-CHECK (unchanged) -->
    <!-- =============================== -->
    <script>
        (async function () {
            const workerBase = "https://visionbank-security.ahmedadeyemi.workers.dev";
            try {
                const res = await fetch(workerBase + "/security/check", {
                    method: "GET",
                    mode: "cors",
                    credentials: "omit"
                });

                if (!res.ok) throw new Error("Worker error " + res.status);
                const data = await res.json();
                window.VB_SECURITY = data;

                if (!data.allowed) {
                    document.body.innerHTML = `
                      <div class="security-denied">
                        <h2>Access Denied</h2>
                        <p>${data.reason}</p>
                      </div>`;
                }
            } catch (err) {
                console.error("Security check failed:", err);
                document.body.innerHTML = `
                  <div class="security-denied">
                    <h2>Access Denied</h2>
                    <p>Security pre-check failed.</p>
                  </div>`;
            }
        })();
    </script>
</head>

<body>

<!-- =============================== -->
<!-- TOP RIGHT CONTROLS -->
<!-- =============================== -->
<div id="topRightControls">
    <span id="alertSettingsToggle" class="panel-toggle">Alert Settings</span>
    <span id="alertHistoryToggle" class="panel-toggle">Alert History</span>
</div>

<!-- =============================== -->
<!-- DARK MODE TOGGLE BOTTOM LEFT -->
<!-- =============================== -->
<div id="themeToggleContainer">
    <button id="darkModeToggle">Dark Mode</button>
</div>

<!-- =============================== -->
<!-- HEADER -->
<!-- =============================== -->
<header class="header">
    <div class="header-left">
        <img src="assets/VisionBank-Logo.png" alt="VisionBank" class="logo" />
    </div>
    <div class="header-center">
        <h1>CEG Contact Center Realtime Dashboard</h1>
        <span class="header-subtitle">VisionBank</span>
    </div>
</header>

<!-- =============================== -->
<!-- ALERT SETTINGS PANEL -->
<!-- =============================== -->
<div id="alertSettingsPanel" class="alert-settings-panel hidden">
    <h3>Alert Settings</h3>

    <label>
        <input type="checkbox" id="enableQueueAlerts" />
        Enable Queue Alerts
    </label>

    <label>
        <input type="checkbox" id="enableVoiceAlerts" />
        Enable Voice Alerts
    </label>

    <label>
        <input type="checkbox" id="enablePopupAlerts" />
        Enable Popup Alerts
    </label>

    <label>
        Alert Tone:
        <select id="alertToneSelect">
            <option value="soft">Soft Chime</option>
            <option value="bright">Bright Bell</option>
            <option value="pulse">Pulse Beep</option>
            <option value="ping">Ping Tone</option>
            <option value="alarm">Alarm Tone</option>
        </select>
    </label>

    <label>
        Volume:
        <input type="range" id="alertVolume" min="0" max="100" />
    </label>

    <label>
        Cooldown Seconds:
        <input type="number" id="alertCooldown" min="10" max="300" />
    </label>

    <label>
        <input type="checkbox" id="wallboardMode" />
        Wallboard Mode
    </label>

    <button id="alertTestButton">Test Alert</button>

    <button id="exitWallboardBtn" class="hidden exit-wallboard-btn">Exit Wallboard Mode</button>

    <hr />

    <h4>Queue Tone Overrides</h4>
    <div id="queueToneOverrides"></div>
</div>

<!-- =============================== -->
<!-- ALERT HISTORY PANEL -->
<!-- =============================== -->
<div id="alertHistoryPanel" class="alert-history-panel hidden">
    <h3>Alert History</h3>
    <div id="alertHistoryList"></div>
    <button id="clearAlertHistory">Clear History</button>
</div>

<!-- =============================== -->
<!-- QUEUE STATUS SECTION -->
<!-- =============================== -->
<section>
    <h2 class="section-title">Current Queue Status</h2>
    <table id="queue-table">
        <thead>
            <tr>
                <th>Queue Name</th>
                <th>Calls</th>
                <th>Agents</th>
                <th>Oldest Wait</th>
                <th>Avg Wait</th>
            </tr>
        </thead>
        <tbody id="queue-body"></tbody>
    </table>
</section>

<!-- =============================== -->
<!-- AGENT PERFORMANCE SECTION -->
<!-- =============================== -->
<section>
    <h2 class="section-title">Agent Performance</h2>
    <table id="agent-table">
        <thead>
            <tr>
                <th>Full Name</th>
                <th>Team</th>
                <th>Number</th>
                <th>Status</th>
                <th>Inbound</th>
                <th>Missed</th>
                <th>Transferred</th>
                <th>Outbound</th>
                <th>Avg Handle</th>
                <th>Time in Status</th>
                <th>Start Date</th>
            </tr>
        </thead>
        <tbody id="agent-body"></tbody>
    </table>
</section>

<!-- =============================== -->
<!-- GLOBAL STATS SECTION -->
<!-- =============================== -->
<section>
    <h2 class="section-title">Realtime Global Statistics</h2>

    <div id="global-error"></div>

    <div class="global-grid">
        <div class="stat-box">
            <label>Total Queued</label>
            <span id="gs-total-queued">--</span>
        </div>

        <div class="stat-box">
            <label>Total Transferred</label>
            <span id="gs-total-transferred">--</span>
        </div>

        <div class="stat-box">
            <label>Total Abandoned</label>
            <span id="gs-total-abandoned">--</span>
        </div>

        <div class="stat-box">
            <label>Max Wait</label>
            <span id="gs-max-wait">--</span>
        </div>

        <div class="stat-box">
            <label>Service Level</label>
            <span id="gs-service-level">--</span>
        </div>

        <div class="stat-box">
            <label>Total Received</label>
            <span id="gs-total-received">--</span>
        </div>

        <div class="stat-box">
            <label>Answer Rate</label>
            <span id="gs-answer-rate">--</span>
        </div>

        <div class="stat-box">
            <label>Abandon Rate</label>
            <span id="gs-abandon-rate">--</span>
        </div>

        <div class="stat-box">
            <label>Callbacks Registered</label>
            <span id="gs-callbacks-registered">--</span>
        </div>

        <div class="stat-box">
            <label>Callbacks Waiting</label>
            <span id="gs-callbacks-waiting">--</span>
        </div>
    </div>
</section>

<!-- =============================== -->
<!-- FOOTER -->
<!-- =============================== -->
<footer id="footerBranding">
    <div class="footer-inner">
        <span class="footer-text">Created and maintained by Ahmed Adeyemi, US Signal, 2025</span>
        <img src="assets/US-Signal-Logo.png" class="footer-logo" alt="US Signal Logo" />
    </div>
</footer>

<script src="new-dashboard.js"></script>

</body>
</html>
