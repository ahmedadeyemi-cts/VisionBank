<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>CEG Security Admin Console | VisionBank</title>
    <link rel="stylesheet" href="security.css" />
</head>
<body>
<header class="vb-header">
    <div class="vb-header-inner">
        <img src="assets/VisionBank-Logo.png" alt="VisionBank" class="vb-logo">
        <div class="vb-title-block">
            <div class="vb-app-name">CEG Security Admin Console</div>
            <div class="vb-app-subtitle">VisionBank</div>
        </div>
    </div>
</header>

<main class="vb-main">

    <!-- ============ LOGIN VIEW ============ -->
    <section id="login-view" class="card">
        <h2>Secure Administrator Login</h2>
        <p class="card-subtitle">
            Sign in with your admin ID, PIN, and (when required) a Google Authenticator code.
        </p>

        <form id="login-form" class="form-grid">
            <label>
                Admin ID
                <input type="text" id="login-username" autocomplete="username">
            </label>

            <label>
                PIN
                <input type="password" id="login-pin" autocomplete="current-password">
            </label>

            <label id="login-totp-wrapper" class="hidden">
                Google Authenticator Code
                <input type="text" id="login-totp" maxlength="6" inputmode="numeric" autocomplete="one-time-code">
            </label>

            <button type="submit" class="btn-primary">Login</button>
        </form>

        <div class="login-helper">
            <strong>Default Super Admin</strong><br>
            ID: <code>superadmin</code> • PIN: <code>ChangeMeNow!</code><br>
            <small>You will be asked to set up Google Authenticator on first login.</small>
        </div>

        <button id="override-toggle" class="link-button">Use Override Key</button>

        <form id="override-form" class="form-inline hidden">
            <input type="password" id="override-input" placeholder="Override key">
            <button type="submit" class="btn-secondary">Enter Override</button>
        </form>

        <div id="login-message" class="message"></div>
    </section>

    <!-- ============ MFA SETUP VIEW ============ -->
    <section id="mfa-setup-view" class="card hidden">
        <h2>Google Authenticator Setup</h2>
        <p class="card-subtitle">
            Scan this QR code or use the text key below in Google Authenticator. Then enter a 6-digit code from the app to confirm.
        </p>

        <div class="mfa-layout">
            <div class="mfa-qr-wrapper">
                <div id="mfa-qr" class="mfa-qr-placeholder">QR loading…</div>
                <p class="mfa-qr-caption">Scan in Google Authenticator</p>
            </div>

            <div class="mfa-details">
                <label>
                    Account
                    <input type="text" id="mfa-account" readonly>
                </label>

                <label>
                    Secret Key
                    <input type="text" id="mfa-secret" readonly>
                </label>

                <label>
                    Enter 6-digit code from app
                    <input type="text" id="mfa-code" maxlength="6" inputmode="numeric">
                </label>

                <button id="mfa-confirm-btn" class="btn-primary">
                    Confirm &amp; Enable MFA
                </button>

                <button id="mfa-cancel-btn" class="btn-link">
                    Cancel
                </button>

                <div id="mfa-message" class="message"></div>
            </div>
        </div>
    </section>

    <!-- ============ ADMIN VIEW ============ -->
    <section id="admin-view" class="card hidden">
        <div class="admin-header">
            <h2>VisionBank Security Administration</h2>
            <button id="logout-btn" class="btn-secondary small">Logout</button>
        </div>
        <p class="card-subtitle">
            Access Control • Monitoring • Business Hours
        </p>

        <!-- Business hours -->
        <section class="admin-section">
            <h3>Business Hours</h3>
            <p class="section-help">
                These hours are enforced on the main dashboard. Outside of these times, access is denied
                unless an admin override is used. All times are interpreted in Central Time (CST/CDT).
            </p>

            <form id="hours-form" class="form-grid hours-grid">
                <label>
                    Start (HH:MM, CST)
                    <input type="time" id="hours-start">
                </label>

                <label>
                    End (HH:MM, CST)
                    <input type="time" id="hours-end">
                </label>

                <fieldset class="days-fieldset">
                    <legend>Active Days (CST)</legend>
                    <label><input type="checkbox" value="1" class="hours-day"> Mon</label>
                    <label><input type="checkbox" value="2" class="hours-day"> Tue</label>
                    <label><input type="checkbox" value="3" class="hours-day"> Wed</label>
                    <label><input type="checkbox" value="4" class="hours-day"> Thu</label>
                    <label><input type="checkbox" value="5" class="hours-day"> Fri</label>
                    <label><input type="checkbox" value="6" class="hours-day"> Sat</label>
                    <label><input type="checkbox" value="0" class="hours-day"> Sun</label>
                </fieldset>

                <button type="submit" class="btn-primary">Save Business Hours</button>
            </form>
        </section>

        <!-- IP allowlist -->
        <section class="admin-section">
            <h3>Allowed IP Ranges</h3>
            <p class="section-help">
                Only IPs/Subnets listed here will be allowed to access the dashboard while rules are active.
                One entry per line. Example formats:
                <code>10.100.100.0/24</code>, <code>45.19.161.17</code>,
                <code>45.19.162.18/32</code>, <code>120.112.1.119/28</code>.
            </p>

            <form id="ip-form">
                <textarea id="ip-textarea" rows="6" spellcheck="false"></textarea>
                <button type="submit" class="btn-primary">Save IP Rules</button>
            </form>
        </section>

        <!-- Audit log -->
        <section class="admin-section">
            <h3>Security Audit Log</h3>
            <p class="section-help">
                Recent security events. For long-term storage and server-side logging, move this to
                a Cloudflare Worker or other backend.
            </p>
            <pre id="audit-log" class="audit-log"></pre>
        </section>
    </section>
</main>

<footer class="vb-footer">
    <div class="vb-footer-inner">
        <span class="vb-footer-left">
            <img src="assets/US-Signal-Logo.png" alt="US Signal" class="footer-logo">
        </span>
        <span class="vb-footer-text">
            Created and maintained by <strong>Ahmed Adeyemi</strong>, US Signal
        </span>
    </div>
</footer>

<script src="security.js"></script>
</body>
</html>
