<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Security Admin Console | VisionBankÂ®</title>
    <link rel="stylesheet" href="security.css" />
</head>

<body class="theme-light">

<!-- ====================================== -->
<!-- HEADER                                 -->
<!-- ====================================== -->
<header class="vb-header">
    <div class="vb-header-inner">
        <img src="assets/VisionBank-Logo.png" alt="VisionBank" class="vb-logo">

        <div class="vb-title-block">
            <div class="vb-app-name">Security Admin Console</div>
            <div class="vb-app-subtitle">VisionBankÂ®</div>
        </div>
    </div>

    <div class="vb-header-actions">
        <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
            <span id="themeToggleIcon">ðŸŒ™</span>
            <span id="themeToggleText">Dark mode</span>
        </button>
    </div>
</header>

<main class="vb-main">

    <!-- ====================================== -->
    <!-- LOGIN VIEW                             -->
    <!-- ====================================== -->
    <section id="login-view" class="card">
        <h2>Secure Administrator Login</h2>
        <p class="card-subtitle">
            Sign in with your Username, Password, and (when required) a Microsoft Authenticator code.
        </p>

        <form id="login-form" class="form-grid">
            <label>
                Username
                <input type="text" id="login-username" autocomplete="username">
            </label>

            <label>
                Password
                <input type="password" id="login-pin" autocomplete="current-password">
            </label>

            <label id="login-totp-wrapper" class="hidden">
                Microsoft Authenticator Code
                <input type="text" id="login-totp" maxlength="6" inputmode="numeric" autocomplete="one-time-code">
            </label>

            <button type="submit" class="btn-primary">Login</button>
        </form>

        <div class="login-helper">
            <strong>If you do not have a login credential, contact IT</strong><be>
            <!--ID: <code>superadmin</code> â€¢ PIN: <code>ChangeMeNow!</code><br>
            <small>You will be asked to set up Microsoft Authenticator on first login.</small> -->
        </div>

        <button id="override-toggle" class="link-button">VisionBankÂ® disabled</button>

        <form id="override-form" class="form-inline hidden">
            <input type="password" id="override-input" placeholder="Override key">
            <button type="submit" class="btn-secondary">Enter Override - Contact Ahmed to Setup</button>
        </form>

        <div id="login-message" class="message"></div>
    </section>

    <!-- ====================================== -->
    <!-- MFA SETUP VIEW                         -->
    <!-- ====================================== -->
    <section id="mfa-setup-view" class="card hidden">
        <h2>Microsoft Authenticator Setup</h2>
        <p class="card-subtitle">
            Scan this QR code or use the text key below in Microsoft Authenticator. 
            Then enter a 6-digit code from the app to confirm.
        </p>

        <div class="mfa-layout">

            <div class="mfa-qr-wrapper">
                <img id="mfa-qr-img" class="mfa-qr-img" alt="MFA QR Code" />
                <p class="mfa-qr-caption">Scan in Microsoft Authenticator</p>
            </div>

            <div class="mfa-details">
                <label>
                    Account
                    <input type="text" id="mfa-account" readonly>
                </label>

                <label>
                    Secret Key
                    <input type="text" id="mfa-secret" readonly>
                </label>

                <label>
                    Enter 6-digit code from app
                    <input type="text" id="mfa-code" maxlength="6" inputmode="numeric">
                </label>

                <button id="mfa-confirm-btn" class="btn-primary">
                    Confirm &amp; Enable MFA
                </button>

                <button id="mfa-cancel-btn" class="btn-link">
                    Cancel
                </button>

                <div id="mfa-message" class="message"></div>
            </div>

        </div>
    </section>

    <!-- ====================================== -->
    <!-- ADMIN VIEW                             -->
    <!-- ====================================== -->
    <section id="admin-view" class="card hidden">

        <div class="admin-header">
            <div>
                <h2>VisionBankÂ® Security Administration</h2>
                <p class="card-subtitle">
                    Access Control â€¢ User Management â€¢ Logs â€¢ Business Rules
                </p>
            </div>
            <button id="logout-btn" class="btn-secondary small">Logout</button>
        </div>

        <!-- Status banner injected by JS (showStatus) -->

        <!-- BUSINESS HOURS -->
        <section id="admin-hours-section" class="admin-section">
            <h3>Business Hours</h3>
            <p class="section-help">
                These hours are enforced on the main dashboard. Outside these times, access is denied
                unless an override is used. All times are CST/CDT automatically adjusted.
            </p>

            <form id="hours-form" class="form-grid hours-grid">
                <label>
                    Start (HH:MM, CST)
                    <input type="time" id="hours-start">
                </label>

                <label>
                    End (HH:MM, CST)
                    <input type="time" id="hours-end">
                </label>

                <fieldset class="days-fieldset">
                    <legend>Active Days (CST)</legend>
                    <label><input type="checkbox" value="1" class="hours-day"> Mon</label>
                    <label><input type="checkbox" value="2" class="hours-day"> Tue</label>
                    <label><input type="checkbox" value="3" class="hours-day"> Wed</label>
                    <label><input type="checkbox" value="4" class="hours-day"> Thu</label>
                    <label><input type="checkbox" value="5" class="hours-day"> Fri</label>
                    <label><input type="checkbox" value="6" class="hours-day"> Sat</label>
                    <label><input type="checkbox" value="0" class="hours-day"> Sun</label>
                </fieldset>

                <button type="submit" class="btn-primary">Save Business Hours</button>
            </form>
        </section>

        <!-- IP ALLOWLIST -->
        <section id="admin-ip-section" class="admin-section">
            <h3>Allowed IPs / Subnets</h3>
            <p class="section-help">
                Only IPs/Subnets listed here will be allowed to access the dashboard during active hours.
                One entry per line. Simply back out the IP to remove an allowed IP.
            </p>

            <form id="ip-form">
                <textarea id="ip-textarea" rows="6" spellcheck="false"></textarea>
                <button type="submit" class="btn-primary">Save IP Rules</button>
            </form>
        </section>
<!-- CIDR TESTER -->
<section id="cidr-tester-section" class="admin-section">
    <h3>CIDR / IP Tester</h3>
    <p class="section-help">
        Test whether an IPv4 or IPv6 address matches any allowlist rule. 
        Uses the same logic as the Cloudflare Worker.
    </p>

    <div class="cidr-tester">
        <label>
            IP Address to Test
            <input type="text" id="cidr-test-ip" placeholder="e.g., 10.100.100.55 or 2600:1700:abcd::1">
        </label>

        <label>
            Rules (auto-loaded)
            <textarea id="cidr-test-rules" rows="4" readonly></textarea>
        </label>

        <button id="cidr-test-btn" class="btn-primary">Run CIDR Test</button>

        <div id="cidr-test-result" class="cidr-test-result hidden"></div>
    </div>
</section>
        <!-- CIDR TESTER PANEL -->
<section id="cidr-tester-section" class="admin-section">
    <h3>CIDR Tester</h3>
    <p class="section-help">
        Test whether an IP belongs to a CIDR range or whether one CIDR is inside another.
        This does not affect live rules; it is only a testing tool.
    </p>

    <div class="cidr-tester-grid">
        <label>
            Test IP or CIDR A
            <input type="text" id="cidr-input-a" placeholder="Example: 45.19.161.17 or 10.0.0.0/24">
        </label>

        <label>
            Against CIDR B
            <input type="text" id="cidr-input-b" placeholder="Example: 10.0.0.0/16">
        </label>

        <button id="cidr-test-btn" class="btn-primary">Run CIDR Test</button>
    </div>

    <div id="cidr-test-result" class="cidr-result-box">
        Enter two values and click "Run CIDR Test".
    </div>
</section>
        <!-- USER MANAGEMENT WILL BE INSERTED HERE BY JS (before audit section) -->

        <!-- AUDIT LOG -->
        <section id="admin-audit-section" class="admin-section">
            <h3>Security Audit Log</h3>
            <p class="section-help">
                Recent security events. For permanent logs, store them within Cloudflare Workers KV or D1.
            </p>
            <pre id="audit-log" class="audit-log"></pre>
        </section>

    </section>

</main>

<!-- ====================================== -->
<!-- FOOTER                                 -->
<!-- ====================================== -->
<footer class="vb-footer">
    <div class="vb-footer-inner">
        <span class="vb-footer-left">
            <img src="assets/US-Signal-Logo.png" alt="US Signal" class="footer-logo">
        </span>
        <span class="vb-footer-text">
            Created and maintained by <strong>Ahmed Adeyemi</strong>, Â©2025. US Signal
        </span>
    </div>
</footer>

<!-- MAIN JS -->
<script src="security.js"></script>

</body>
</html>
